<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PhysiVerse - Tạp chí Khoa học & Công nghệ</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400..700;1,400..700&family=Montserrat:wght@400;500;700&display=swap" rel="stylesheet">

    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">

    <style>
        /* --- CSS Variables & Global Reset --- */
        :root {
            --primary-color: #0A2F5B; --secondary-color: #005A9C; --accent-color: #E8A87C;
            --text-color: #333333; --light-gray: #f8f9fa; --border-color: #dee2e6;
            --success-color: #28a745; --error-color: #dc3545; --heart-color: #e2264d;
            --font-heading: 'Lora', serif; --font-body: 'Montserrat', sans-serif;
            --shadow: 0 4px 15px rgba(0,0,0,0.07);
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; }
        body { font-family: var(--font-body); line-height: 1.7; color: var(--text-color); background-color: #ffffff; }
        .container { max-width: 1200px; margin: 0 auto; padding: 0 20px; }

        /* --- LOADING SPINNER --- */
        .loader-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255, 255, 255, 0.8); display: flex; justify-content: center; align-items: center; z-index: 9999; opacity: 0; visibility: hidden; transition: opacity 0.3s, visibility 0.3s; }
        .loader-overlay.show { opacity: 1; visibility: visible; }
        .loader { border: 8px solid var(--light-gray); border-top: 8px solid var(--primary-color); border-radius: 50%; width: 60px; height: 60px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* --- Header & Navigation --- */
        .main-header { background-color: #fff; border-bottom: 1px solid var(--border-color); padding: 15px 0; position: sticky; top: 0; z-index: 1000; transition: box-shadow 0.3s ease; }
        .main-header.scrolled { box-shadow: var(--shadow); }
        .main-header .container { display: flex; justify-content: space-between; align-items: center; }
        .logo { font-family: var(--font-heading); color: var(--primary-color); font-size: 2.5rem; margin: 0; font-weight: 700; }
        .main-nav ul { list-style: none; display: flex; }
        .main-nav li { margin-left: 30px; }
        #management-nav-link { display: none; }
        .main-nav a { text-decoration: none; color: var(--primary-color); font-weight: 500; font-size: 1rem; padding-bottom: 5px; position: relative; }
        .main-nav a::after { content: ''; position: absolute; width: 0; height: 2px; bottom: 0; left: 50%; background-color: var(--accent-color); transition: all 0.3s ease-in-out; }
        .main-nav a:hover::after, .main-nav a.active::after { width: 100%; left: 0; }
        .header-actions { display: flex; align-items: center; }
        .header-actions .user-info { display: none; align-items: center; }
        .header-actions .user-info span { margin-right: 15px; font-weight: 500; color: var(--primary-color); }
        .header-actions .user-info .btn { margin-left: 10px; }

        /* --- Buttons --- */
        .btn { padding: 10px 20px; border-radius: 5px; text-decoration: none; font-weight: bold; transition: all 0.3s ease; border: none; cursor: pointer; font-size: 0.95rem; }
        .btn:disabled { background-color: #ccc; cursor: not-allowed; transform: none; }
        .btn-primary { background-color: var(--primary-color); color: #fff; }
        .btn-primary:hover:not(:disabled) { background-color: var(--secondary-color); transform: translateY(-2px); }
        .btn-secondary { background-color: var(--accent-color); color: #fff; padding: 12px 28px; font-size: 1.05rem; }
        .btn-secondary:hover:not(:disabled) { background-color: #d99160; transform: translateY(-2px); }
        .btn-logout { background-color: var(--error-color); color: white; }
        .btn-logout:hover:not(:disabled) { background-color: #c82333; }
        .btn-post-article { background-color: var(--success-color); color: white; }
        .btn-post-article:hover:not(:disabled) { background-color: #218838; }

        /* --- Hero & General Sections --- */
        .hero-section { background: linear-gradient(rgba(10, 47, 91, 0.85), rgba(10, 47, 91, 0.85)), url('https://placehold.co/1920x1080/0A2F5B/FFFFFF?text=PhysiVerse+Background') no-repeat center center; background-size: cover; color: #fff; text-align: center; padding: 120px 0; }
        .hero-section h2 { font-family: var(--font-heading); font-size: 3.5rem; margin-bottom: 20px; font-weight: 700; }
        .hero-section p { font-size: 1.25rem; max-width: 700px; margin: 0 auto 40px auto; opacity: 0.9; }
        .latest-issue { padding: 80px 0; background-color: var(--light-gray); min-height: 400px; }
        .section-title { text-align: center; font-family: var(--font-heading); font-size: 2.8rem; color: var(--primary-color); margin-bottom: 60px; position: relative; }
        .section-title::after { content: ''; display: block; width: 80px; height: 3px; background-color: var(--accent-color); margin: 15px auto 0; }
        #no-articles-message { text-align: center; color: #6c757d; padding: 50px 0; }
        #no-articles-message h3 { font-family: var(--font-heading); margin-bottom: 10px; }
        .search-bar { max-width: 600px; margin: -20px auto 40px auto; position: relative; }
        .search-bar input { width: 100%; padding: 15px 20px; font-size: 1rem; border-radius: 50px; border: 1px solid var(--border-color); transition: box-shadow 0.3s; }
        .search-bar input:focus { outline: none; box-shadow: 0 0 0 4px rgba(0, 90, 156, 0.2); border-color: var(--secondary-color); }

        /* --- Article Card --- */
        .articles-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 30px; }
        .article-card { background-color: #fff; border-radius: 8px; overflow: hidden; display: flex; flex-direction: column; box-shadow: var(--shadow); transition: transform 0.3s ease, box-shadow 0.3s ease; cursor: pointer; }
        .article-card:hover { transform: translateY(-8px); box-shadow: 0 8px 25px rgba(0,0,0,0.1); }
        .article-image { width: 100%; height: 220px; object-fit: cover; background-color: var(--light-gray); }
        .article-content { padding: 25px; flex-grow: 1; display: flex; flex-direction: column; }
        .article-category { display: inline-block; background-color: var(--secondary-color); color: #fff; padding: 5px 10px; border-radius: 5px; font-size: 0.8rem; font-weight: bold; margin-bottom: 15px; align-self: flex-start; }
        .article-title { font-family: var(--font-heading); font-size: 1.4rem; margin-bottom: 10px; }
        .article-title a { text-decoration: none; color: var(--primary-color); transition: color 0.3s ease; }
        .article-card:hover .article-title a { color: var(--accent-color); }
        .article-authors { font-size: 0.9rem; color: #6c757d; margin-bottom: 15px; }
        .article-excerpt { margin-bottom: 20px; flex-grow: 1; }
        .read-more { color: var(--secondary-color); text-decoration: none; font-weight: bold; align-self: flex-start; }
        .article-card:hover .read-more { text-decoration: underline; }

        /* --- Footer --- */
        .main-footer { background-color: var(--primary-color); color: rgba(255, 255, 255, 0.8); padding: 60px 0; line-height: 1.8; }
        .main-footer a { color: rgba(255, 255, 255, 0.8); text-decoration: none; transition: color 0.3s ease; }
        .main-footer a:hover { color: #fff; text-decoration: underline; }
        .footer-content { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 40px; margin-bottom: 40px; }
        .footer-content h4 { font-family: var(--font-heading); font-size: 1.5rem; margin-bottom: 20px; color: var(--accent-color); }
        .footer-links ul { list-style: none; }
        .footer-links li { margin-bottom: 10px; }
        .footer-contact p { margin-bottom: 10px; }
        .footer-copyright { text-align: center; padding-top: 40px; border-top: 1px solid rgba(255,255,255,0.2); opacity: 0.7; }

        /* --- Login Modal --- */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.6); display: none; justify-content: center; align-items: center; z-index: 2000; animation: fadeIn 0.3s ease-out; }
        .modal-overlay.active { display: flex; }
        .modal-container { background: #fff; padding: 40px; border-radius: 8px; width: 90%; max-width: 450px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); position: relative; animation: slideIn 0.3s ease-out; }
        .modal-close { position: absolute; top: 15px; right: 15px; font-size: 1.5rem; border: none; background: none; cursor: pointer; color: #aaa; transition: color 0.2s ease; }
        .modal-close:hover { color: var(--text-color); }
        .modal-header h3 { font-family: var(--font-heading); color: var(--primary-color); margin-bottom: 20px; text-align: center; font-size: 1.8rem; }
        
        /* --- Forms & Messages --- */
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 500; color: var(--text-color); }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: 5px; font-size: 1rem; font-family: var(--font-body); }
        .form-group textarea { min-height: 100px; resize: vertical; }
        #login-error, #post-message { padding: 10px; border-radius: 5px; margin-bottom: 15px; text-align: center; display: none; font-weight: 500; }
        #login-error, #post-message.error { background-color: rgba(220, 53, 69, 0.1); color: var(--error-color); }
        #post-message.success { background-color: rgba(40, 167, 69, 0.1); color: var(--success-color); }
        
        /* --- Page Sections --- */
        .page-section { display: none; animation: slideUp 0.5s ease-in-out; }
        .page-section.active { display: block; }
        #postArticlePage, #managementPage { padding: 80px 0; background-color: var(--light-gray); }
        #postArticlePage h2, #managementPage h2 { font-family: var(--font-heading); font-size: 2.8rem; color: var(--primary-color); margin-bottom: 40px; text-align: center; }
        .post-form, .management-container { background: #fff; padding: 40px; border-radius: 8px; box-shadow: var(--shadow); max-width: 900px; margin: 0 auto; }
        #coverImagePreview { max-width: 100%; height: auto; max-height: 300px; margin-top: 15px; border-radius: 5px; border: 1px solid var(--border-color); display: none; }
        
        /* --- Management Page --- */
        .management-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        .management-table th, .management-table td { padding: 12px 15px; border: 1px solid var(--border-color); text-align: left; vertical-align: middle; }
        .management-table th { background-color: var(--light-gray); font-weight: bold; }
        .management-table tbody tr:hover { background-color: var(--light-gray); }
        .management-table td.actions { text-align: center; width: 120px; }
        .action-btn { background: none; border: none; padding: 5px; margin: 0 5px; cursor: pointer; }
        .action-btn svg { width: 20px; height: 20px; transition: transform 0.2s; }
        .action-btn:hover svg { transform: scale(1.2); }
        .btn-edit svg { fill: var(--secondary-color); }
        .btn-delete svg { fill: var(--error-color); }

        /* --- Article Detail Page --- */
        #articleDetailPage { padding: 80px 0; }
        .article-detail-container { max-width: 800px; margin: 0 auto; background: #fff; padding: 40px; border-radius: 8px; box-shadow: var(--shadow); }
        .article-detail-header img { width: 100%; max-height: 400px; object-fit: cover; border-radius: 5px; margin-bottom: 20px; background-color: var(--light-gray); }
        .article-detail-header h1 { font-family: var(--font-heading); font-size: 2.8rem; color: var(--primary-color); line-height: 1.3; margin-bottom: 15px; }
        .article-meta { font-size: 0.9rem; color: #6c757d; margin-bottom: 30px; border-top: 1px solid var(--border-color); border-bottom: 1px solid var(--border-color); padding: 15px; background-color: var(--light-gray); border-radius: 5px; }
        .article-meta p { margin: 5px 0; }
        .article-meta strong { color: var(--text-color); }
        .article-full-content { font-size: 1.1rem; line-height: 1.8; }
        .article-full-content h2, .article-full-content h3 { font-family: var(--font-heading); color: var(--primary-color); margin-top: 30px; margin-bottom: 15px; }
        .article-full-content blockquote { border-left: 4px solid var(--accent-color); padding-left: 20px; margin: 20px 0; font-style: italic; color: #555; }
        #backToHomeBtn { margin-bottom: 40px; }

        /* --- Likes & Comments --- */
        .interaction-section { margin-top: 40px; border-top: 1px solid var(--border-color); padding-top: 20px; }
        .like-section { display: flex; align-items: center; gap: 10px; font-size: 1.2rem; font-weight: 500; color: var(--text-color); }
        .like-btn { background: none; border: none; cursor: pointer; padding: 5px; display: flex; align-items: center; }
        .like-btn svg { width: 30px; height: 30px; fill: #ccc; transition: all 0.2s ease; }
        .like-btn.liked svg { fill: var(--heart-color); animation: pulse 0.5s; }
        .like-btn:hover:not(.liked) svg { fill: #aaa; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.3); } 100% { transform: scale(1); } }
        .comment-section { margin-top: 40px; }
        .comment-section h3 { font-family: var(--font-heading); color: var(--primary-color); margin-bottom: 20px; }
        #comment-form { display: flex; flex-direction: column; gap: 15px; margin-bottom: 30px; }
        #comment-form input, #comment-form textarea { width: 100%; }
        #comment-form button { align-self: flex-start; }
        #comment-list { list-style: none; }
        .comment-item { background-color: var(--light-gray); padding: 15px; border-radius: 8px; margin-bottom: 15px; }
        .comment-item p { margin: 0; }
        .comment-item .comment-meta { font-size: 0.9rem; font-weight: bold; color: var(--secondary-color); margin-bottom: 5px; }
        .comment-item .comment-meta span { font-weight: normal; color: #6c757d; margin-left: 10px; font-size: 0.8rem; }
        
        /* --- General Page Content --- */
        .page-content-container { max-width: 900px; margin: 0 auto; background: #fff; padding: 40px; border-radius: 8px; box-shadow: var(--shadow); line-height: 1.8; }
        .page-content-container p, .page-content-container ul { margin-bottom: 1.5rem; }
        .page-content-container h3 { font-family: var(--font-heading); color: var(--secondary-color); margin-top: 2rem; margin-bottom: 1rem; border-bottom: 2px solid var(--border-color); padding-bottom: 0.5rem; }
        
        /* --- Scroll to Top --- */
        #scrollToTopBtn { display: none; position: fixed; bottom: 30px; right: 30px; z-index: 99; border: none; outline: none; background-color: var(--primary-color); color: white; cursor: pointer; padding: 15px; border-radius: 50%; font-size: 18px; width: 50px; height: 50px; transition: all 0.3s; opacity: 0.8; }
        #scrollToTopBtn:hover { opacity: 1; transform: scale(1.1); }

        /* --- Quill Editor --- */
        .ql-toolbar.ql-snow { border-radius: 5px 5px 0 0; border-color: var(--border-color); background-color: #f0f2f5; }
        .ql-container.ql-snow { border-radius: 0 0 5px 5px; border-color: var(--border-color); min-height: 300px; font-family: var(--font-body); font-size: 1rem; line-height: 1.6; }
        .ql-editor strong { font-weight: bold; }
        .ql-editor em { font-style: italic; }

        /* --- Responsive Design --- */
        @media (max-width: 768px) {
            .hero-section h2 { font-size: 2.5rem; }
            .main-header .container, .header-actions, .header-actions .user-info { flex-direction: column; }
            .logo, .main-nav ul { margin-bottom: 15px; }
            .main-nav li { margin: 5px 10px; }
            .header-actions .user-info span { margin-right: 0; margin-bottom: 10px; }
            .header-actions .user-info .btn { margin-left: 0; margin-top: 10px; }
        }
    </style>
</head>
<body>
    <div class="loader-overlay" id="loader-overlay">
        <div class="loader"></div>
    </div>

    <header class="main-header" id="mainHeader">
        <div class="container">
            <h1 class="logo">PhysiVerse</h1>
            <nav class="main-nav">
                <ul>
                    <li><a href="#" class="nav-link active" data-target="homePage">Trang Chủ</a></li>
                    <li id="management-nav-link"><a href="#" class="nav-link" data-target="managementPage">Quản Lý</a></li>
                    <li><a href="#" class="nav-link" data-target="submitArticle">Nộp Bài Báo</a></li>
                    <li><a href="#" class="nav-link" data-target="aboutUs">Về Chúng Tôi</a></li>
                </ul>
            </nav>
            <div class="header-actions">
                <button id="loginBtn" class="btn btn-primary">Đăng Nhập</button>
                <div id="userInfo" class="user-info">
                    <span id="loggedInUsername">Chào, admin!</span>
                    <button id="postArticleLink" class="btn btn-post-article">Đăng Bài</button>
                    <button id="logoutBtn" class="btn btn-logout">Đăng Xuất</button>
                </div>
            </div>
        </div>
    </header>

    <main>
        <!-- Home Page Section -->
        <section id="homePage" class="page-section active">
            <section class="hero-section">
                <div class="container">
                    <h2>Khám Phá Ranh Giới Mới Của Tri Thức</h2>
                    <p>Nơi công bố những nghiên cứu đột phá trong lĩnh vực Vật lý, Công nghệ và Trí tuệ nhân tạo.</p>
                    <a href="#latest-issue-section" class="btn btn-secondary">Xem Bài Mới Nhất</a>
                </div>
            </section>

            <section class="latest-issue" id="latest-issue-section">
                <div class="container">
                    <h3 class="section-title">Nghiên Cứu Nổi Bật</h3>
                    <div class="search-bar">
                         <input type="text" id="homeSearchInput" placeholder="Tìm kiếm bài báo theo tiêu đề hoặc tác giả...">
                    </div>
                    <div id="no-articles-message" style="display: none;">
                        <h3>Chưa có bài báo nào được xuất bản.</h3>
                        <p>Hãy đăng nhập và là người đầu tiên đóng góp cho PhysiVerse!</p>
                    </div>
                    <div class="articles-grid">
                        <!-- Articles will be loaded here by JavaScript -->
                    </div>
                </div>
            </section>
        </section>

        <!-- Post Article Page Section -->
        <section id="postArticlePage" class="page-section">
            <div class="container">
                <h2 id="post-form-title">Đăng Bài Báo Mới</h2>
                <form id="articlePostForm" class="post-form">
                    <div id="post-message"></div>
                    <div class="form-group">
                        <label for="articleTitle">Tiêu đề bài báo</label>
                        <input type="text" id="articleTitle" name="articleTitle" required>
                    </div>
                    <div class="form-group">
                        <label for="coverImageInput">Ảnh bìa (chọn từ máy tính, dưới 2MB)</label>
                        <input type="file" id="coverImageInput" name="coverImageInput" accept="image/*">
                        <img id="coverImagePreview" src="#" alt="Xem trước ảnh bìa">
                    </div>
                    <div class="form-group">
                        <label for="articleAuthors">Tác giả</label>
                        <input type="text" id="articleAuthors" name="articleAuthors" required>
                    </div>
                    <div class="form-group">
                        <label for="articleAffiliation">Đơn vị công tác</label>
                        <input type="text" id="articleAffiliation" name="articleAffiliation" required>
                    </div>
                    <div class="form-group">
                        <label for="articleEmail">Email liên hệ</label>
                        <input type="email" id="articleEmail" name="articleEmail" required>
                    </div>
                    <div class="form-group">
                        <label for="articleCategory">Phân loại</label>
                        <select id="articleCategory" name="articleCategory" required>
                            <option value="">-- Chọn chuyên ngành --</option>
                            <optgroup label="Khoa học Tự nhiên">
                                <option value="Vật lý Lượng tử">Vật lý Lượng tử</option>
                                <option value="Vật lý Thiên văn">Vật lý Thiên văn</option>
                                <option value="Vật lý Chất rắn">Vật lý Chất rắn</option>
                            </optgroup>
                            <optgroup label="Công nghệ & Tin học">
                                <option value="Trí tuệ Nhân tạo">Trí tuệ Nhân tạo (AI)</option>
                                <option value="Khoa học Dữ liệu">Khoa học Dữ liệu</option>
                                <option value="Công nghệ">Công nghệ</option>
                            </optgroup>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="articleExcerpt">Mô tả tóm tắt</label>
                        <textarea id="articleExcerpt" name="articleExcerpt" rows="4" required></textarea>
                    </div>
                    <div class="form-group">
                        <label>Nội dung bài báo</label>
                        <div id="editor-container"></div>
                    </div>
                    <button type="submit" id="submit-post-btn" class="btn btn-primary" style="width: 100%; margin-top: 30px;">Xuất Bản</button>
                </form>
            </div>
        </section>
        
        <!-- Article Detail Page Section -->
        <section id="articleDetailPage" class="page-section">
            <div class="container">
                <button id="backToHomeBtn" class="btn btn-primary">&larr; Quay lại Trang chủ</button>
                <div class="article-detail-container">
                    <div class="article-detail-header">
                        <img id="detailCoverImage" src="" alt="Article Cover Image">
                        <h1 id="detailTitle"></h1>
                        <div class="article-meta">
                            <p><strong>Tác giả:</strong> <span id="detailAuthors"></span></p>
                            <p><strong>Đơn vị:</strong> <span id="detailAffiliation"></span></p>
                            <p><strong>Email:</strong> <a id="detailEmailLink" href="#"><span id="detailEmail"></span></a></p>
                            <p><strong>Ngày đăng:</strong> <span id="detailDate"></span> | <strong>Chuyên ngành:</strong> <span id="detailCategory"></span></p>
                        </div>
                    </div>
                    <div id="detailContent" class="article-full-content ql-editor"></div>
                    <div class="interaction-section">
                         <div id="like-section-container"></div>
                         <div class="comment-section">
                            <h3>Bình Luận</h3>
                            <form id="comment-form">
                                <div class="form-group">
                                    <label for="commentAuthor">Tên của bạn</label>
                                    <input type="text" id="commentAuthor" required>
                                </div>
                                <div class="form-group">
                                    <label for="commentContent">Nội dung bình luận</label>
                                    <textarea id="commentContent" rows="4" required></textarea>
                                </div>
                                <button type="submit" class="btn btn-primary">Gửi Bình Luận</button>
                            </form>
                            <ul id="comment-list"></ul>
                         </div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Management Page Section -->
        <section id="managementPage" class="page-section">
            <div class="container">
                <h2>Quản Lý Bài Báo</h2>
                <div class="management-container">
                    <div class="search-bar">
                         <input type="text" id="manageSearchInput" placeholder="Tìm kiếm bài báo...">
                    </div>
                    <div class="table-responsive">
                         <table class="management-table">
                            <thead>
                                <tr>
                                    <th>Tiêu đề</th>
                                    <th>Tác giả</th>
                                    <th>Chuyên mục</th>
                                    <th>Ngày đăng</th>
                                    <th>Hành động</th>
                                </tr>
                            </thead>
                            <tbody id="management-table-body"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>


        <!-- About Us & Submit Page Sections (Giữ nguyên) -->
        <section id="aboutUs" class="page-section" style="padding: 80px 0;">
             <div class="container">
                <h2 class="section-title">Về Chúng Tôi</h2>
                <div class="page-content-container">
                    <h3>Tầm Nhìn</h3>
                    <p>PhysiVerse được xây dựng với tầm nhìn trở thành một kho lưu trữ tri thức hiện đại, dễ tiếp cận và đáng tin cậy trong các lĩnh vực khoa học và công nghệ mũi nhọn.</p>
                    <h3>Sứ Mệnh Của PhysiVerse</h3>
                    <p>Sứ mệnh của chúng tôi là đẩy nhanh tốc độ phổ biến tri thức và thúc đẩy các khám phá khoa học tiên tiến. Bằng cách cung cấp một nền tảng xuất bản truy cập mở, chúng tôi kết nối cộng đồng các nhà nghiên cứu, đồng thời truyền cảm hứng cho thế hệ các nhà khoa học tương lai.</p>
                </div>
            </div>
        </section>
        <section id="submitArticle" class="page-section" style="padding: 80px 0;">
            <div class="container">
                <h2 class="section-title">Nộp Bài Báo</h2>
                <div class="page-content-container">
                    <h3>Quy Trình Xuất Bản</h3>
                    <p>Tại PhysiVerse, chúng tôi áp dụng một quy trình xuất bản tinh gọn dành cho Quản trị viên. Với vai trò là người điều hành, bạn có toàn quyền đăng tải và quản lý nội dung của tạp chí.</p>
                    <h3>Lưu ý cho Admin</h3>
                    <p>Bạn chịu trách nhiệm về tính chính xác, khoa học và bản quyền của mọi nội dung được đăng tải. Hãy đảm bảo rằng các bài báo đều đạt chất lượng cao nhất để duy trì uy tín của PhysiVerse.</p>
                    <div style="text-align: center; margin-top: 30px;">
                        <button class="btn btn-primary" id="goToPostPageBtn">Đến trang Đăng bài</button>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="main-footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-about">
                    <h4>Về PhysiVerse</h4>
                    <p>Tạp chí khoa học & công nghệ truy cập mở, dành riêng cho việc phổ biến tri thức và thúc đẩy các khám phá tiên phong.</p>
                </div>
                <div class="footer-links">
                    <h4>Liên Kết Hữu Ích</h4>
                    <ul>
                        <li><a href="#" class="nav-link" data-target="homePage">Trang Chủ</a></li>
                        <li><a href="#" class="nav-link" data-target="aboutUs">Về Chúng Tôi</a></li>
                        <li><a href="#" class="nav-link" data-target="submitArticle">Hướng dẫn Đăng bài</a></li>
                    </ul>
                </div>
                <div class="footer-contact">
                    <h4>Thông Tin Liên Hệ</h4>
                    <p><strong>Email:</strong> <a href="mailto:contact@physiverse.com">contact@physiverse.com</a></p>
                </div>
            </div>
            <div class="footer-copyright">
                <p>&copy; 2025 PhysiVerse. All Rights Reserved.</p>
            </div>
        </div>
    </footer>
    
    <div class="modal-overlay" id="loginModal">
        <div class="modal-container">
            <button class="modal-close" id="closeModalBtn">&times;</button>
            <div class="modal-header"><h3>Đăng Nhập Quản Trị</h3></div>
            <div class="modal-body">
                <form id="loginForm">
                    <p id="login-error"></p>
                    <div class="form-group"><label for="usernameInput">Tên đăng nhập</label><input type="text" id="usernameInput" required></div>
                    <div class="form-group"><label for="passwordInput">Mật khẩu</label><input type="password" id="passwordInput" required></div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">Đăng Nhập</button>
                </form>
            </div>
        </div>
    </div>
    
    <button id="scrollToTopBtn" title="Lên đầu trang">&#8679;</button>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {

            // =================================================================
            // === CẤU HÌNH KHO LƯU TRỮ ĐÁM MÂY (SUPABASE) ===
            // =================================================================
            const SUPABASE_URL = 'https://fkvrocertlbzawsrazxt.supabase.co'; // Dán URL của bạn vào đây
            const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZrdnJvY2VydGxiemF3c3Jhenh0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg0MzUyODEsImV4cCI6MjA3NDAxMTI4MX0.s81PEwFfUO9ewJbwx-1yLRCW9S44pjeYYikgmLsKEI0'; // Dán anon key của bạn vào đây
            // =================================================================

            const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

            let editingArticleId = null;
            let allArticlesCache = [];
            let currentArticleId = null;

            const ui = {
                loader: document.getElementById('loader-overlay'),
                header: document.getElementById('mainHeader'),
                navLinks: document.querySelectorAll('.nav-link'),
                pageSections: document.querySelectorAll('.page-section'),
                loginModal: document.getElementById('loginModal'),
                openModalBtn: document.getElementById('loginBtn'),
                closeModalBtn: document.getElementById('closeModalBtn'),
                loginForm: document.getElementById('loginForm'),
                userInfoContainer: document.getElementById('userInfo'),
                logoutBtn: document.getElementById('logoutBtn'),
                postArticleLink: document.getElementById('postArticleLink'),
                goToPostPageBtn: document.getElementById('goToPostPageBtn'),
                articlePostForm: document.getElementById('articlePostForm'),
                articlesGrid: document.querySelector('.articles-grid'),
                noArticlesMessage: document.getElementById('no-articles-message'),
                scrollToTopBtn: document.getElementById('scrollToTopBtn'),
                managementNavLink: document.getElementById('management-nav-link'),
                managementTableBody: document.getElementById('management-table-body'),
                postFormTitle: document.getElementById('post-form-title'),
                submitPostBtn: document.getElementById('submit-post-btn'),
                homeSearchInput: document.getElementById('homeSearchInput'),
                manageSearchInput: document.getElementById('manageSearchInput'),
                likeSectionContainer: document.getElementById('like-section-container'),
                commentForm: document.getElementById('comment-form'),
                commentList: document.getElementById('comment-list')
            };

            const showLoader = () => ui.loader.classList.add('show');
            const hideLoader = () => ui.loader.classList.remove('show');

            const showMessage = (elementId, message, isSuccess = true) => {
                const el = document.getElementById(elementId);
                el.textContent = message;
                el.className = isSuccess ? 'success' : 'error';
                el.style.display = 'block';
            };

            const showPage = (targetId) => {
                ui.pageSections.forEach(section => section.style.display = 'none');
                const targetPage = document.getElementById(targetId);
                if (targetPage) {
                    targetPage.style.display = 'block';
                    window.scrollTo(0, 0);
                }
                document.querySelectorAll('.nav-link').forEach(link => {
                    link.classList.toggle('active', link.dataset.target === targetId);
                });
            };

            const updateLoginState = () => {
                const isLoggedIn = sessionStorage.getItem('isLoggedIn') === 'true';
                ui.openModalBtn.style.display = isLoggedIn ? 'none' : 'block';
                ui.userInfoContainer.style.display = isLoggedIn ? 'flex' : 'none';
                ui.managementNavLink.style.display = isLoggedIn ? 'list-item' : 'none';
                if (isLoggedIn) {
                    document.getElementById('loggedInUsername').textContent = `Chào, ${sessionStorage.getItem('loggedInUser')}!`;
                } else if (!document.getElementById('homePage').classList.contains('active')) {
                    showPage('homePage');
                }
            };

            const renderArticles = (articles) => {
                ui.articlesGrid.innerHTML = '';
                ui.noArticlesMessage.style.display = articles.length === 0 ? 'block' : 'none';
                articles.forEach(article => {
                    ui.articlesGrid.insertAdjacentHTML('beforeend', `
                        <article class="article-card" data-id="${article.id}">
                            <img src="${article.coverImage}" alt="${article.title}" class="article-image">
                            <div class="article-content">
                                <span class="article-category">${article.category}</span>
                                <h4 class="article-title"><a href="#" data-id="${article.id}">${article.title}</a></h4>
                                <p class="article-authors">Bởi ${article.authors}</p>
                                <p class="article-excerpt">${article.excerpt}</p>
                                <a href="#" class="read-more" data-id="${article.id}">Đọc Toàn Văn &rarr;</a>
                            </div>
                        </article>`);
                });
            };

            const fetchAndRenderArticles = async () => {
                showLoader();
                const { data, error } = await supabase.from('articles').select('*').order('created_at', { ascending: false });
                hideLoader();
                if (error) {
                    alert("Lỗi kết nối đến kho lưu trữ đám mây.");
                } else {
                    allArticlesCache = data;
                    renderArticles(allArticlesCache);
                }
            };

            const displayArticleDetail = async (articleId) => {
                currentArticleId = articleId;
                showLoader();
                const { data: article, error } = await supabase.from('articles').select('*').eq('id', articleId).single();
                hideLoader();

                if (error || !article) {
                     alert("Không tìm thấy bài báo.");
                     return;
                }
                
                document.getElementById('detailCoverImage').src = article.coverImage;
                document.getElementById('detailTitle').textContent = article.title;
                document.getElementById('detailAuthors').textContent = article.authors;
                document.getElementById('detailAffiliation').textContent = article.affiliation;
                document.getElementById('detailEmail').textContent = article.email;
                document.getElementById('detailEmailLink').href = `mailto:${article.email}`;
                document.getElementById('detailDate').textContent = article.date;
                document.getElementById('detailCategory').textContent = article.category;
                document.getElementById('detailContent').innerHTML = article.content;
                
                await renderLikeSection(article.id, article.like_count);
                await renderComments(article.id);
                showPage('articleDetailPage');
            };

            const renderLikeSection = async (articleId, likeCount) => {
                const likedArticles = JSON.parse(localStorage.getItem('likedArticles')) || [];
                const isLiked = likedArticles.includes(articleId);
                ui.likeSectionContainer.innerHTML = `
                    <div class="like-section">
                        <button class="like-btn ${isLiked ? 'liked' : ''}" id="like-btn" data-id="${articleId}">
                            <svg viewBox="0 0 24 24"><path d="M12,21.35L10.55,20.03C5.4,15.36 2,12.27 2,8.5C2,5.41 4.42,3 7.5,3C9.24,3 10.91,3.81 12,5.08C13.09,3.81 14.76,3 16.5,3C19.58,3 22,5.41 22,8.5C22,12.27 18.6,15.36 13.45,20.03L12,21.35Z"/></svg>
                        </button>
                        <span id="like-count">${likeCount || 0}</span> Lượt thích
                    </div>`;
            };

            const handleLikeClick = async (articleId) => {
                const likeButton = document.getElementById('like-btn');
                const countElement = document.getElementById('like-count');
                const likedArticles = JSON.parse(localStorage.getItem('likedArticles')) || [];

                if (likedArticles.includes(articleId)) return;

                const { error } = await supabase.rpc('increment_likes', { article_id_to_inc: articleId });

                if (!error) {
                    likedArticles.push(articleId);
                    localStorage.setItem('likedArticles', JSON.stringify(likedArticles));
                    likeButton.classList.add('liked');
                    countElement.textContent = parseInt(countElement.textContent) + 1;
                }
            };
            
            const renderComments = async (articleId) => {
                const { data: comments, error } = await supabase.from('comments').select('*').eq('article_id', articleId).order('created_at', { ascending: false });
                ui.commentList.innerHTML = '';
                if (comments) {
                    comments.forEach(comment => {
                        const commentDate = new Date(comment.created_at).toLocaleString('vi-VN');
                        ui.commentList.insertAdjacentHTML('beforeend', `
                            <li class="comment-item">
                                <p class="comment-meta">${comment.author_name} <span>${commentDate}</span></p>
                                <p>${comment.content}</p>
                            </li>`);
                    });
                }
            };

            const handleCommentSubmit = async (e) => {
                e.preventDefault();
                const authorInput = document.getElementById('commentAuthor');
                const contentInput = document.getElementById('commentContent');
                const submitBtn = e.target.querySelector('button');

                if (!authorInput.value.trim() || !contentInput.value.trim()) return;

                submitBtn.disabled = true; submitBtn.textContent = 'Đang gửi...';

                const { error } = await supabase.from('comments').insert([{ article_id: currentArticleId, author_name: authorInput.value.trim(), content: contentInput.value.trim() }]);

                if (error) {
                    alert('Lỗi khi gửi bình luận.');
                } else {
                    e.target.reset();
                    await renderComments(currentArticleId);
                }
                submitBtn.disabled = false; submitBtn.textContent = 'Gửi Bình Luận';
            };

            const renderManagementList = (articles) => {
                ui.managementTableBody.innerHTML = '';
                articles.forEach(article => {
                    ui.managementTableBody.insertAdjacentHTML('beforeend', `
                        <tr>
                            <td>${article.title}</td>
                            <td>${article.authors}</td>
                            <td>${article.category}</td>
                            <td>${article.date}</td>
                            <td class="actions">
                                <button class="action-btn btn-edit" data-id="${article.id}" title="Sửa"><svg viewBox="0 0 24 24"><path d="M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.13,5.12L18.88,8.87M3,17.25V21H6.75L17.81,9.94L14.06,6.19L3,17.25Z" /></svg></button>
                                <button class="action-btn btn-delete" data-id="${article.id}" title="Xóa"><svg viewBox="0 0 24 24"><path d="M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z" /></svg></button>
                            </td>
                        </tr>`);
                });
            };

            const populateFormForEdit = async (articleId) => {
                showLoader();
                const { data: article } = await supabase.from('articles').select('*').eq('id', articleId).single();
                hideLoader();
                if (!article) return;

                editingArticleId = article.id;
                ui.articlePostForm.articleTitle.value = article.title;
                ui.articlePostForm.articleAuthors.value = article.authors;
                ui.articlePostForm.articleAffiliation.value = article.affiliation;
                ui.articlePostForm.articleEmail.value = article.email;
                ui.articlePostForm.articleCategory.value = article.category;
                ui.articlePostForm.articleExcerpt.value = article.excerpt;
                quill.root.innerHTML = article.content;
                
                const preview = document.getElementById('coverImagePreview');
                preview.src = article.coverImage;
                preview.style.display = 'block';

                ui.postFormTitle.textContent = 'Chỉnh Sửa Bài Báo';
                ui.submitPostBtn.textContent = 'Cập Nhật Bài Báo';
                showPage('postArticlePage');
            };
            
            const resetPostForm = () => {
                editingArticleId = null;
                ui.articlePostForm.reset();
                quill.setContents([{ insert: '\n' }]);
                document.getElementById('coverImagePreview').style.display = 'none';
                document.getElementById('coverImagePreview').src = '#';
                ui.postFormTitle.textContent = 'Đăng Bài Báo Mới';
                ui.submitPostBtn.textContent = 'Xuất Bản';
            };


            // --- EVENT LISTENERS ---

            window.onscroll = () => {
                const isScrolled = document.body.scrollTop > 100 || document.documentElement.scrollTop > 100;
                ui.header.classList.toggle('scrolled', isScrolled);
                ui.scrollToTopBtn.style.display = isScrolled ? "block" : "none";
            };
            ui.scrollToTopBtn.addEventListener('click', () => window.scrollTo({top: 0, behavior: 'smooth'}));
            
            document.body.addEventListener('click', async (e) => {
                const navLink = e.target.closest('.nav-link');
                if (navLink) {
                    e.preventDefault();
                    if (editingArticleId) resetPostForm();
                    const targetId = navLink.dataset.target;
                    showPage(targetId);
                    if (targetId === 'managementPage') {
                        showLoader();
                        if (allArticlesCache.length === 0) await fetchAndRenderArticles();
                        renderManagementList(allArticlesCache);
                        hideLoader();
                    }
                }
            });
            
            ui.goToPostPageBtn.addEventListener('click', () => {
                if(sessionStorage.getItem('isLoggedIn') === 'true') showPage('postArticlePage');
                else {
                    alert('Bạn cần đăng nhập để truy cập trang này.');
                    ui.loginModal.classList.add('active');
                }
            });
            document.getElementById('backToHomeBtn').addEventListener('click', () => showPage('homePage'));
            ui.articlesGrid.addEventListener('click', (e) => {
                 if (e.target.closest('.article-card')) {
                    e.preventDefault();
                    const articleId = e.target.closest('.article-card').dataset.id;
                    displayArticleDetail(articleId);
                }
            });

            const validUsername = 'admin';
            const validPasswords = ['hieu2k10', 'khoi2k10', 'hung2k10'];
            ui.openModalBtn.addEventListener('click', () => ui.loginModal.classList.add('active'));
            ui.closeModalBtn.addEventListener('click', () => ui.loginModal.classList.remove('active'));
            ui.loginModal.addEventListener('click', (e) => { if (e.target === ui.loginModal) ui.loginModal.classList.remove('active'); });
            
            ui.loginForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const usernameValue = document.getElementById('usernameInput').value;
                const passwordValue = document.getElementById('passwordInput').value;
                
                if (usernameValue === validUsername && validPasswords.includes(passwordValue)) {
                    alert('Đăng nhập thành công!');
                    ui.loginModal.classList.remove('active');
                    sessionStorage.setItem('isLoggedIn', 'true');
                    sessionStorage.setItem('loggedInUser', usernameValue);
                    updateLoginState();
                } else {
                    showMessage('login-error', 'Tên đăng nhập hoặc mật khẩu không đúng.', false);
                }
            });

            ui.logoutBtn.addEventListener('click', () => {
                sessionStorage.clear();
                updateLoginState();
            });
            ui.postArticleLink.addEventListener('click', (e) => {
                e.preventDefault();
                if (editingArticleId) resetPostForm();
                showPage('postArticlePage');
            });

            let quill;
            if (document.getElementById('editor-container')) {
                quill = new Quill('#editor-container', {
                    theme: 'snow',
                    placeholder: 'Bắt đầu viết nội dung bài báo của bạn tại đây...',
                    modules: { toolbar: [
                        [{ 'header': [1, 2, 3, false] }],
                        ['bold', 'italic', 'underline', 'strike'], ['blockquote', 'code-block'],
                        [{ 'list': 'ordered'}, { 'list': 'bullet' }],
                        ['link', 'image'], [{ 'align': [] }], ['clean']
                    ]}
                });
            }

            if (ui.articlePostForm) {
                ui.articlePostForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    ui.submitPostBtn.disabled = true; ui.submitPostBtn.textContent = 'Đang xử lý...';
                    const form = e.target;
                    
                    if (!form.articleTitle.value || !form.articleAuthors.value || quill.getLength() <= 1 || document.getElementById('coverImagePreview').src === window.location.href) {
                        showMessage('post-message', 'Vui lòng điền đầy đủ các trường và chọn ảnh bìa.', false);
                        ui.submitPostBtn.disabled = false;
                        ui.submitPostBtn.textContent = editingArticleId ? 'Cập Nhật Bài Báo' : 'Xuất Bản';
                        return;
                    }
                    
                    const articleData = {
                        title: form.articleTitle.value, coverImage: document.getElementById('coverImagePreview').src,
                        authors: form.articleAuthors.value, affiliation: form.articleAffiliation.value,
                        email: form.articleEmail.value, category: form.articleCategory.value,
                        excerpt: form.articleExcerpt.value, content: quill.root.innerHTML,
                        date: editingArticleId ? (allArticlesCache.find(a => a.id == editingArticleId).date) : new Date().toLocaleDateString('vi-VN')
                    };

                    showLoader();
                    let error;
                    if (editingArticleId) {
                        const { error: updateError } = await supabase.from('articles').update(articleData).eq('id', editingArticleId);
                        error = updateError;
                    } else {
                        const { error: insertError } = await supabase.from('articles').insert([{...articleData, like_count: 0}]);
                        error = insertError;
                    }
                    hideLoader();

                    if (error) {
                        showMessage('post-message', `Lỗi: ${error.message}`, false);
                    } else {
                        showMessage('post-message', `Bài báo đã được ${editingArticleId ? 'cập nhật' : 'xuất bản'} thành công!`, true);
                        resetPostForm();
                        setTimeout(async () => {
                            document.getElementById('post-message').style.display = 'none';
                            showPage('homePage');
                            await fetchAndRenderArticles();
                        }, 2000);
                    }
                    ui.submitPostBtn.disabled = false;
                });

                document.getElementById('coverImageInput').addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    if (file && file.size < 2 * 1024 * 1024) {
                        const reader = new FileReader();
                        reader.onload = (event) => {
                            document.getElementById('coverImagePreview').src = event.target.result;
                            document.getElementById('coverImagePreview').style.display = 'block';
                        }
                        reader.readAsDataURL(file);
                    } else if (file) {
                        alert("Lỗi: Kích thước ảnh không được vượt quá 2MB.");
                        e.target.value = '';
                    }
                });
            }

            ui.managementTableBody.addEventListener('click', async (e) => {
                const target = e.target.closest('.action-btn');
                if (!target) return;
                const articleId = target.dataset.id;
                if (target.classList.contains('btn-edit')) {
                    await populateFormForEdit(articleId);
                } else if (target.classList.contains('btn-delete')) {
                    if (confirm('Bạn có chắc chắn muốn xóa bài báo này? Tất cả bình luận liên quan cũng sẽ bị xóa.')) {
                        showLoader();
                        await supabase.from('comments').delete().eq('article_id', articleId);
                        const { error } = await supabase.from('articles').delete().eq('id', articleId);
                        hideLoader();
                        if (error) {
                             alert(`Lỗi khi xóa: ${error.message}`);
                        } else {
                            await fetchAndRenderArticles();
                            renderManagementList(allArticlesCache);
                        }
                    }
                }
            });
            
            const handleSearch = (searchInput, listRenderer, articleSource) => {
                const searchTerm = searchInput.value.toLowerCase();
                const filteredArticles = articleSource.filter(article => 
                    article.title.toLowerCase().includes(searchTerm) || 
                    article.authors.toLowerCase().includes(searchTerm)
                );
                listRenderer(filteredArticles);
            };

            ui.homeSearchInput.addEventListener('input', () => handleSearch(ui.homeSearchInput, renderArticles, allArticlesCache));
            ui.manageSearchInput.addEventListener('input', () => handleSearch(ui.manageSearchInput, renderManagementList, allArticlesCache));
            
            ui.likeSectionContainer.addEventListener('click', (e) => {
                if (e.target.closest('#like-btn')) {
                    const articleId = e.target.closest('#like-btn').dataset.id;
                    handleLikeClick(parseInt(articleId));
                }
            });
            ui.commentForm.addEventListener('submit', handleCommentSubmit);

            // --- INITIALIZATION ---
            updateLoginState();
            fetchAndRenderArticles();
        });
    </script>
</body>
</html>
